!function(){"use strict";const e="/send-email.php",t=1e4,n=document.getElementById("contactForm"),o={company:document.getElementById("company"),name:document.getElementById("name"),phone:document.getElementById("phone"),email:document.getElementById("email"),service:document.getElementById("service"),consent:document.getElementById("consent")},s={company:{required:!0,minLength:2,message:"Моля, въведете име на компания (минимум 2 символа)"},name:{required:!0,minLength:2,pattern:/^[а-яА-Яa-zA-Z\s\-]+$/,message:"Моля, въведете вашите имена (минимум 2 символа)"},phone:{required:!0,pattern:/^[\+]?[0-9\s\-\(\)]{9,}$/,message:"Моля, въведете валиден телефонен номер"},email:{required:!0,pattern:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"Моля, въведете валиден email адрес"},service:{required:!0,message:"Моля, изберете услуга"},consent:{required:!0,message:"Моля, потвърдете съгласието си за обработка на лични данни"}};function r(e,t){const n="checkbox"===e.type?e.checked:e.value.trim();let o=!0,s="";return t.required&&("checkbox"===e.type?n||(o=!1,s=t.message):n&&""!==n||(o=!1,s=t.message)),o&&t.minLength&&n.length<t.minLength&&(o=!1,s=t.message),o&&t.pattern&&!t.pattern.test(n)&&(o=!1,s=t.message),{isValid:o,errorMessage:s}}function a(e,t){const n=e.closest(".form-group").querySelector(".error-message");e.classList.add("error"),e.setAttribute("aria-invalid","true"),n&&(n.textContent=t,n.style.display="block")}function i(e){const t=e.closest(".form-group").querySelector(".error-message");e.classList.remove("error"),e.removeAttribute("aria-invalid"),t&&(t.textContent="",t.style.display="none")}function c(e,t){const n=window.location.pathname.includes("/en")?"en":"bg",o=document.createElement("div");o.style.cssText="\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background-color: rgba(0, 0, 0, 0.5);\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            z-index: 10000;\n            animation: fadeIn 0.3s ease;\n        ";const s=document.createElement("div");s.style.cssText="\n            background-color: white;\n            padding: 40px;\n            border-radius: 8px;\n            max-width: 500px;\n            width: 90%;\n            text-align: center;\n            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);\n            animation: slideUp 0.3s ease;\n        ";const r=document.createElement("div");r.style.cssText="\n            font-size: 48px;\n            margin-bottom: 20px;\n        ",r.textContent="success"===t?"✓":"✕",r.style.color="success"===t?"#28a745":"#D32F2F";const a=document.createElement("p");a.style.cssText="\n            font-size: 18px;\n            color: #333;\n            margin-bottom: 30px;\n            line-height: 1.6;\n        ",a.textContent=e;const i=document.createElement("button");i.textContent="en"===n?"Close":"Затвори",i.className="btn btn-primary",i.style.cssText="\n            cursor: pointer;\n        ",s.appendChild(r),s.appendChild(a),s.appendChild(i),o.appendChild(s),document.body.appendChild(o);const c=()=>{o.style.animation="fadeOut 0.3s ease",setTimeout(()=>{document.body.removeChild(o)},300)};i.addEventListener("click",c),o.addEventListener("click",function(e){e.target===o&&c()}),document.addEventListener("keydown",function e(t){"Escape"===t.key&&(c(),document.removeEventListener("keydown",e))})}Object.keys(o).forEach(e=>{const t=o[e],n=s[e];t&&n&&(t.addEventListener("blur",function(){const{isValid:e,errorMessage:t}=r(this,n);e?i(this):a(this,t)}),t.addEventListener("input",function(){if(this.classList.contains("error")){const{isValid:e}=r(this,n);e&&i(this)}}),"checkbox"===t.type&&t.addEventListener("change",function(){const{isValid:e,errorMessage:t}=r(this,n);e?i(this):a(this,t)}))}),n&&n.addEventListener("submit",function(d){if(d.preventDefault(),!function(){let e=!0;return Object.keys(o).forEach(t=>{const n=o[t],c=s[t];if(n&&c){const{isValid:t,errorMessage:o}=r(n,c);t?i(n):(a(n,o),e=!1)}}),e}()){const e=n.querySelector(".error");return void(e&&e.focus())}const l=d.target.querySelector('button[type="submit"]'),m=l.textContent,u=window.location.pathname.includes("/en")?"en":"bg";l.disabled=!0,l.textContent="en"===u?"Sending...":"Изпраща се...";const p={company:o.company.value.trim(),name:o.name.value.trim(),phone:o.phone.value.trim(),email:o.email.value.trim(),service:o.service.value,timestamp:(new Date).toLocaleString("bg-BG")};"undefined"!=typeof dataLayer&&dataLayer.push({event:"form_submission",form_name:"contact_form",service_selected:p.service});const h=new AbortController,y=setTimeout(()=>h.abort(),t);fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p),signal:h.signal}).then(function(e){if(clearTimeout(y),!e.ok)throw new Error("Network response was not ok: "+e.status);return e.json()}).then(function(e){if(!e.success)throw new Error(e.message||"Unknown error occurred");console.log("Form submission SUCCESS:",e.message),function(e,t){const s=window.location.pathname.includes("/en")?"en":"bg";e.textContent="en"===s?"Successfully sent!":"Изпратено успешно!",e.style.backgroundColor="#28a745",function(){const e=window.location.pathname.includes("/en")?"en":"bg",t="en"===e?"Your request has been sent successfully! We will contact you soon.":"Вашата заявка е изпратена успешно! Ще се свържем с вас скоро.";c(t,"success")}(),"undefined"!=typeof dataLayer&&dataLayer.push({event:"form_submission_success",form_name:"contact_form"});n.reset(),Object.values(o).forEach(e=>{e&&i(e)}),setTimeout(()=>{e.disabled=!1,e.textContent=t,e.style.backgroundColor=""},3e3)}(l,m)}).catch(function(e){clearTimeout(y),console.error("Form submission ERROR:",e),"AbortError"===e.name&&console.error("Request timeout"),function(e,t){e.disabled=!1,e.textContent=t,function(){const e=window.location.pathname.includes("/en")?"en":"bg",t="en"===e?"Error sending your request. Please try again or contact us directly.":"Грешка при изпращане. Моля, опитайте отново или се свържете с нас директно.";c(t,"error")}(),"undefined"!=typeof dataLayer&&dataLayer.push({event:"form_submission_error",form_name:"contact_form"})}(l,m)})});const d=document.createElement("style");d.textContent="\n        @keyframes fadeIn {\n            from { opacity: 0; }\n            to { opacity: 1; }\n        }\n        @keyframes fadeOut {\n            from { opacity: 1; }\n            to { opacity: 0; }\n        }\n        @keyframes slideUp {\n            from {\n                opacity: 0;\n                transform: translateY(30px);\n            }\n            to {\n                opacity: 1;\n                transform: translateY(0);\n            }\n        }\n    ",document.head.appendChild(d),o.phone&&o.phone.addEventListener("input",function(e){let t=this.value.replace(/[^\d\+]/g,"");t.startsWith("0")&&10===t.length&&(t="+359"+t.substring(1));(t.match(/\+/g)||[]).length>1&&(t="+"+t.replace(/\+/g,"")),this.value=t}),console.log("Form validation and PHP SMTP handler initialized"),console.log("Form endpoint: "+e)}();